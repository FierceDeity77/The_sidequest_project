{% load widget_tweaks %}
{% load static %}

<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Modal Body -->
      <div class="modal-body">
        <form method="post" enctype="multipart/form-data" id="editProfileForm" action="{% url 'user-profile' user_profile.email %}">
          {% csrf_token %}

          {% for field in profile_form %}
            {% if field.name == "avatar" %} <!-- for avatar field -->
              <div class="mb-3 text-center">
                <label class="form-label d-block">{{ field.label }}</label>
                
                
                <!-- Avatar preview -->
                   <!-- Preview target -->
                    {% if user_profile.avatar %}
                      <img id="avatarPreview" src="{{ user_profile.avatar.url }}" 
                          alt="Current Avatar" class="rounded-circle mb-2" width="120" height="120">
                    {% else %}
                      <img id="avatarPreview" src="{% static 'images/default-avatar.png' %}" 
                          alt="Default Avatar" class="rounded-circle mb-2" width="120" height="120">
                    {% endif %}

                    <!-- File input with preview target -->
                    <div class="mt-2">
                      {% render_field field class="form-control" id="id_avatar" data-preview-target="avatarPreview" %}
                    </div>
                    <div class="text-danger small">{{ field.errors }}</div>
                  </div>
            {% else %}
              <div class="mb-3">
                <label class="form-label">{{ field.label }} {{ field.help_text }}</label>
                {% render_field field class="form-control" %}
                <div class="text-danger small">{{ field.errors }}</div>
              </div>
            {% endif %}
          {% endfor %}
        </form>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" form="editProfileForm" class="btn btn-primary">Save Changes</button>
      </div>

    </div>
  </div>
</div>
<!-- Avatar Preview Script -->
<script src="{% static "js/scripts.js" %}"></script>