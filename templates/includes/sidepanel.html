{% load static %}
<!-- Sidebar Column -->

<!-- About Hub/Community -->
<div class="card mb-3">
  <div class="card-header bg-light fw-bold">
    {% if community.content_type == "Community" %}
      About Hub
    {% else %}
      About Tavern
    {% endif %}
  </div>
  <div class="card-body">
    <!-- Hub/Community name + icon -->
    <div class="d-flex align-items-center mb-3">
      {% if community.icon %}
        <img src="{{ community.icon.url }}" alt="{{ community.name }}"
             class="rounded me-2" width="40" height="40">
      {% else %}
        <div class="rounded bg-secondary me-2" 
             style="width:40px; height:40px;"></div>
      {% endif %}
      <div>
        {% if community.content_type == "Community" %}
        <a href="{% url 'content:community-detail' community.slug %}">
          <h6 class="mb-0">h/{{ community.name }}</h6>
        </a>
        {% else %}
        <a href="{% url 'content:subcommunity-detail' community.slug %}">
          <h6 class="mb-0">h/{{ community.name }}</h6>
        </a>
        {% endif %}
        <small class="text-muted">Created {{ community.created_at|date:"M d, Y" }}</small>
      </div>
    </div>

    <!-- Description -->
    {% if community.description %}
      <p class="small text-muted">{{ community.description|truncatechars:120 }}</p>
    {% endif %}

    <!-- Member Count -->
    <div class="mb-3">
      <span class="fw-bold d-block" id="followers-{{ community.id }}">
        {{ community.member_count }}
      </span>
      <small class="text-muted">Members</small>
    </div>

    <!-- Follow Button -->
     {% if request.user.is_authenticated %}
    <div class="d-grid gap-2 mb-3">
      <button class="btn btn-sm btn-outline-success follow-btn" 
              data-id="{{ community.id }}" 
              data-model="community"
              data-action="follow"
              data-csrf="{{ csrf_token }}">
       {% if request.user in community.members.all %} Unfollow
       {% else %} Follow {% endif %}
      </button>
    </div>
    {% endif %}

    <!-- Edit community info -->
    <div class="mb-3">
      <!-- show button to admin and local moderators -->
      {% if request.user.role == "admin" or request.user in community.moderators.all %} 
      <a href="#" 
         class="btn btn-outline-secondary btn-sm w-100" data-bs-toggle="modal" data-bs-target="#editCommunityModal">
         {% if community.content_type == "Community" %}
           Edit Hub Info
         {% else %}
           Edit Tavern Info
        {% endif %}
      </a>
      {% endif %}
    </div>

    <!-- Create Sub-community -->
     {% if request.user.is_authenticated %}
    <div class="mb-3">
      {% if community.content_type == "Community" %}
      <a href="#" 
         class="btn btn-outline-secondary btn-sm w-100" data-bs-toggle="modal" data-bs-target="#addSubCommunityModal">
        Create Tavern
      </a>
      {% endif %}
    </div>
    {% endif %}

    <!-- Moderators Section -->
<div class="moderators-section mt-3">
  <h6 class="fw-bold mb-2">Moderators</h6>
  <ul class="list-unstyled small mb-3">
    {% for mod in community.moderators.all %}
      <li class="d-flex align-items-center mb-2">
        <!-- Avatar -->
        {% if mod.avatar %}
          <img src="{{ mod.avatar.url }}" 
               alt="{{ mod.username }} avatar" 
               class="rounded-circle me-2 border" 
               width="28" height="28">
        {% else %}
          <img src="{% static 'default_images/default-avatar.jpg' %}" 
               alt="Default avatar" 
               class="rounded-circle me-2 border" 
               width="28" height="28">
        {% endif %}

        <!-- Name -->
        <a href="{% url 'user-profile' mod.id %}" 
           class="text-dark text-decoration-none moderator-link">
          p/{{ mod.username }}
        </a>
      </li>
    {% empty %}
      <li class="text-muted">No moderators yet.</li>
    {% endfor %}
  </ul>
</div>

    <!-- Rules -->
    <h6 class="fw-bold">Rules</h6>
    <ul class="small ps-3">
      {% for rules in community.rules %}
        {{ rules }}
      {% empty %}
        <li class="text-muted">No rules added yet.</li>
      {% endfor %}
    </ul>
  </div>
</div>

<!-- Top Sub-communities -->
 {% if community.content_type == "Community" %}
<div class="card mb-3">
  <div class="card-header fw-bold">    
    üè†üç∫ Taverns
  </div>
<ul class="list-group list-group-flush">
  {% for sub in list_of_subs %}
    <li class="list-group-item d-flex align-items-center py-2">
      <!-- Subcommunity Icon -->
      {% if sub.icon %}
        <img src="{{ sub.icon.url }}" alt="{{ sub.name }} icon"
             class="rounded-circle me-2 border"
             width="20" height="20">
      {% else %}
        <div class="rounded-circle bg-secondary me-2 border"
             style="width:20px; height:20px;"></div>
      {% endif %}

      <!-- Subcommunity Name -->
      <a href="{% url 'content:subcommunity-detail' sub.slug %}" 
         class="sub-link small">
        t/{{ sub.name }}
      </a>
    </li>
  {% empty %}
    <li class="list-group-item text-muted small">No sub-communities yet.</li>
  {% endfor %}
</ul>
</div> {% endif %}

<!-- User Games may like -->
<div class="card">
  <div class="card-header fw-bold">
    üéÆ Games You May Like 
  </div>
  <ul class="list-group list-group-flush">
    <li class="list-group-item text-muted">You don‚Äôt follow any yet.</li>
    {% comment %} {% if user.is_authenticated %}
      {% for followed in user.followed_communities.all %}
        <li class="list-group-item">
          <a href="{% url 'content:community-detail' followed.slug %}">
            {{ followed.name }}
          </a>
        </li>
      {% empty %}
        <li class="list-group-item text-muted">You don‚Äôt follow any yet.</li>
      {% endfor %}
    {% else %}
      <li class="list-group-item text-muted">Login to see followed communities.</li>
    {% endif %} {% endcomment %}
  </ul>
</div>