{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block page_title %} Community Overview {% endblock %}

{% block header %} Detail {% endblock %}

{% block content %} 

<!-- Banner (full width) -->
<div class="banner-wrapper mb-3">
  {% if community.banner %}
    <img src="{{ community.banner.url }}" 
         alt="{{ community.name }} banner" 
         class="banner-img w-100">
  {% else %}
    <img src="{% static 'default_images/default-cover.png' %}" 
         alt="Default banner" 
         class="banner-img w-100">
  {% endif %}
</div>

<!-- Community Header -->
<div class="card-body">
  <div class="d-flex align-items-center mb-3">
    {% if community.icon %}
      <img src="{{ community.icon.url }}" 
           alt="{{ community.name }} icon"
           class="rounded-circle border me-3"
           width="96" height="96">
    {% else %}
      <img src="{% static 'default_images/default-community-icon.png' %}" 
           alt="Default community icon"
           class="rounded-circle border me-3"
           width="96" height="96">
    {% endif %}

    <div>
      <h2 class="card-title mb-1 text-dark community-title">{{ community.name }}</h2>
      

      <!-- Meta Info -->
      <div class="d-flex flex-wrap text-muted small mt-2">
        <a href="{% url 'user-profile' community.created_by.id %}" class="creator-link me-3">
            ðŸ‘¤ <strong>{{ community.created_by.username }}</strong>
        </a>
        
        {% if community.parent %}
          <div class="d-flex align-items-center mb-2">
            <!-- Parent Community Icon -->
            {% if community.parent.icon %}
              <img src="{{ community.parent.icon.url }}" 
                  alt="{{ community.parent.name }}" 
                  class="rounded me-2 border" 
                  width="32" height="32">
            {% else %}
              <div class="rounded bg-secondary me-2 border" 
                  style="width:20px; height:20px;"></div>
            {% endif %}

            <!-- Parent Community Link -->
            <a href="{% url 'content:community-detail' community.parent.slug %}" 
              class="sub-link small fw-semibold">
              {{ community.parent.name }}
            </a>
          </div>
        {% endif %}
        <!-- content type badges -->
        {% if community.content_type == "Community" %}
          <span class="ms-3">
            <span class="badge bg-primary">{{ community.content_type }}</span>
            <span class="badge bg-success">General</span>
          </span>
        {% else %}
          <span class="ms-3">
            <span class="badge bg-danger">{{ community.content_type }}</span>
          </span>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Action Buttons -->
 {% if request.user.is_authenticated %}
<div class="d-flex justify-content-between mb-3">
  <a href="#" 
     class="btn create-topic-btn btn-sm rounded-3 fw-semibold" 
     data-bs-toggle="modal" 
     data-bs-target="#createTopicModal">
    <i class="bi bi-plus-lg me-1"></i> Create Topic
  </a>
</div>
{% endif %}

<!-- Topics Section -->
<div class="topics-list">
  {% for topic in topics %}
    <div class="card shadow-sm mb-3">
      <a href="{% url 'content:topic-detail' topic.slug %}" 
         class="text-decoration-none text-dark p-3 d-block">
        
        <!-- Author + timestamp -->
        <div class="d-flex align-items-center mb-2">
          {% if topic.author.avatar %}
            <img src="{{ topic.author.avatar.url }}" 
                 alt="{{ topic.author.username }}'s avatar" 
                 class="rounded-circle me-2"
                 width="24" height="24">
          {% else %}
            <img src="{% static 'avatars/default-avatar.jpg' %}" 
                 alt="Default avatar" 
                 class="rounded-circle me-2"
                 width="24" height="24">
          {% endif %}
          <small class="text-muted">
            <span class="fw-semibold">{{ topic.author.username }}</span>
            â€¢ {{ topic.created_at|timesince }} ago
          </small>
        </div>

        <!-- Title -->
        <div class="fs-5 fw-bold">{{ topic.title }}</div>
      </a>

      <!-- Footer: votes + comments -->
      <div class="d-flex justify-content-between align-items-center px-3 pb-2">
      <div class="d-flex align-items-center gap-2">
        {% include "content/includes/topic_vote_buttons.html" %}
      </div>
      <div>
        <span class="text-muted">{{ topic.comment_count }} comments</span>
      </div>
    </div>
  </div> 
  {% empty %}
    <div class="text-muted">No topics available.</div>
  {% endfor %}
</div>

<!-- Include Create Topic Modal -->
{% include "content/add_topic_modal.html" %}
<!-- Include Edit Community Modal -->
{% include "content/edit_community_modal.html" %}
<!-- Include Create Sub-community Modal -->
{% include "content/add_sub-community_modal.html" %}

{% endblock %}

{% block left_panel %}
  {% include "includes/left_sidepanel.html" %}
{% endblock %}

{% block right_panel %}
  {% include "includes/sidepanel.html" %}
{% endblock %}