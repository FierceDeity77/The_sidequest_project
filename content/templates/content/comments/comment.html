{% load comments_tags %}
{% load static %}

{% comment %} the recursive part, this render the comment itself {% endcomment %}
{% comment %} checks if it has children if yes then calls the same tag again {% endcomment %}
<div class="comment d-flex mb-2 ms-{{ comment.parent|yesno:'4,0' }}">
  <div class="comment-avatar">
    {% if comment.author and comment.author.avatar %}
      <img src="{{ comment.author.avatar.url }}" alt="avatar" 
           class="rounded-circle" width="28" height="28">
    {% else %}
      <img src="{% static 'default_images/default-avatar.jpg' %}" alt="avatar" 
           class="rounded-circle" width="28" height="28">
    {% endif %}
  </div>

  <div class="comment-body ms-2">
    <span class="fw-bold small text-muted me-2">
      {{ comment.author.username }}
    </span>
    <span class="text-muted small">
      {{ comment.created_at|timesince }} ago
    </span>

    <p class="mb-1">{{ comment.text }}</p>

    <!-- Voting section -->
    <div class="d-flex align-items-center gap-2 mb-1">
      <button class="btn btn-sm btn-outline-success vote-btn" 
              data-id="{{ comment.id }}" 
              data-type="post" 
              data-model="comments"  {% comment %} this passes the model string "comments" and urls.py path <str:model> which will then pass to the view to identify the model {% endcomment %}
              data-action="upvote" 
              data-csrf="{{ csrf_token }}"> <!-- csrf injected every button carries it's own csrf-->
        ▲ <span id="upvotes-{{ comment.id }}">{{ comment.upvotes.count }}</span>
      </button>

      <button class="btn btn-sm btn-outline-danger vote-btn" 
              data-id="{{ comment.id }}" 
              data-type="post" 
              data-model="comments"
              data-action="downvote" 
              data-csrf="{{ csrf_token }}">
        ▼ <span id="downvotes-{{ comment.id }}">{{ comment.downvotes.count }}</span>
      </button>

      <span class="text-muted small">{{ comment.replies.count }} replies</span>
    </div>

    <!-- Reply button / form -->
    {% include "content/includes/reply.html" %}

    <!-- Recursive replies -->
    {% if comment.replies.all %}
      <div class="comment-replies mt-2">
        {% for reply in comment.replies.all %}
          {% render_comment reply topic %}
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>

